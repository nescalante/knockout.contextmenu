/* knockout.contextmenu v0.3.0
   Nicol√°s Escalante - nlante@gmail.com
   Issues: https://github.com/nescalante/knockout.contextmenu/issues
   License: MIT */

!function(a){"use strict";function b(b,c){function d(){f&&f.parentNode&&f.parentNode.removeChild(f),f=null}function e(a){for(var b=0;b<g.length;b++)if(g[b].element===a)return g[b]}var f,g=[],h=b.utils,i=h.registerEventHandler,j=b.isObservable;i(c,"click",function(a){a.defaultPrevented||d()}),h.contextMenu={getMenuFor:function(a,b){var c=e(a);return c?c.get(b):void 0},openMenuFor:function(a,b){var c=e(a);return c?c.open(b):void 0}},b.bindingHandlers.contextMenu={init:function(e,h,k,l){function m(a){return a.pageX?a.pageX:a.clientX?a.clientX+(c.documentElement.scrollLeft||c.body.scrollLeft):null}function n(a){return a.pageY?a.pageY:a.clientY?a.clientY+(c.documentElement.scrollTop||c.body.scrollTop):null}function o(a){var b;return r=p(a),b=r.element,d(),a?(b.style.top=n(a)+"px",b.style.left=m(a)+"px",a.preventDefault(),a.stopPropagation()):(b.style.top=e.offsetTop+e.offsetHeight+"px",b.style.left=e.offsetLeft+e.offsetWidth+"px"),(c.body||c).appendChild(b),f=b,r}function p(){function a(a){var b=q(a),c=[];b.isVisible&&(e=e||b.isBoolean,b.isChecked&&c.push("checked"),b.isDisabled&&c.push("disabled"),b.isSeparator&&c.push("separator"),b.url&&c.push("with-url"),g.push('<li class="'+c.join(" ")+'">'+b.html+"</li>"),h.push(b.action)),j.push(b)}var d,e=!1,g=[],h=[],j=[],k=Object.keys(b.isObservable(s)?s():s);return k.forEach(function(b){a(b)}),g.length&&(d=c.createElement("div"),d.className=u,d.innerHTML='<ul class="'+(e?"has-checks":"")+'">'+g.join("")+"</ul>",g.forEach(function(a,b){i(d.children[0].children[b],"click",function(a){var c=h[b](l,a);!c&&a&&a.preventDefault()})})),{element:d,items:j,open:o,hide:function(){d&&d.parentNode&&d.parentNode.removeChild(d),f=null}}}function q(c){function d(a,b){var d=c+" option must have an action or an url.";if(o)return!1;if(j(h)&&"boolean"==typeof h())h(!h());else if("object"==typeof h){if(!(h.action||i||p))throw d;h.action&&(j(h.action)&&"boolean"==typeof h.action()?h.action(!h.action()):h.action(a,b))}else{if("function"!=typeof h)throw d;h(a,b)}return!0}var e="",f="",g=b.isObservable(s)?s()[c]:s[c],h=g||{},i=j(h.url)?h.url():h.url,k=h.visible===a||null===h.visible||j(h.visible)&&h.visible()||!j(h.visible)&&!!h.visible,l=!1,m=!h.disabled||j(h.disabled)&&!h.disabled()||j(h.enabled)&&h.enabled()||!j(h.enabled)&&!!h.enabled,n=!1,o=!m,p=!!g.separator;return p||(e=j(h.text)?h.text():h.text,e||(e=c),f=i?'<a href="'+i+'">'+e+"</a>":e),(j(h)&&"boolean"==typeof h()||j(h.action)&&"boolean"==typeof h.action())&&(n=!0,(h.action&&h.action()||"function"==typeof h&&h())&&(l=!0)),{html:f,text:e,url:i,isVisible:k,isChecked:l,isEnabled:m,isDisabled:o,isBoolean:n,isSeparator:p,action:d}}var r,s=h()||{},t=k(),u=t.contextMenuClass||"context-menu";t.bindMenuOnClick&&i(e,"click",o),(t.bindMenuOnContextMenu===a||t.bindMenuOnContextMenu)&&i(e,"contextmenu",o),g.push({element:e,get:function(){return r},open:o,hide:function(){r&&r.hide()}})}}}typeof ko!=a+""&&typeof document!=a+""&&b(ko,document),typeof module!=a+""&&module.exports&&(module.exports=b)}();